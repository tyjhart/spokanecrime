---
title: "R Notebook"
output: html_notebook
---
```{r setup}
library(readtext)
library(tidyverse)
library(stringi)
source("./offense_dict.R") # Offense types, categories
source("./text_wrangling.R") # Build crime data frame
source("./plot_data.R") # Build data frames for plotting
source("./summer_dates.R") # Dates for start / end of summer
```

```{r total_data_frames}
# Total by district
total.crimes_district <- df.crimes %>%
  count(district) %>%
  mutate(
    "total" = n,
    "percentage" = (n / sum(n)) * 100
  )

# Total auto-involved by district
total.auto_district <-  aggregate(motor_vehicle_involved ~ district, df.crimes, sum)

# Total offenses by type
total.offense_types <- df.crimes %>%
  group_by(offense) %>%
  summarize(
    "total" = length(offense)
  )
```

Spokane is divided into eight police districts, P1 - P8. Most offenses that occur have a district number associated in the data. Some offenses that occur outside a defined district or in an unknown location are marked as Other ("Oth"). Here are the districts:

* P1 - Northwest District
* P2 - Central District
* P3 - Neva-Wood District
* P4 - Northeast District
* P5 - South Central District
* P6 - Southeast District
* P7 - Southwest District
* P8 - Downtown

The Northwest District includes Indian Trail, Five Mile, and some of Five Mile Prarie neighborhoods...

```{r plot.total_offenses_over_time, fig.cap = "Total Offenses Over Time", fig.align = 'center'}
df.crimes %>% 
  count(date) %>%
  ggplot(aes(date, n)) + 
  geom_point() +
  geom_smooth(method = "auto", color = "blue") +
  geom_smooth(method = "lm", color = "red") +
  geom_vline(xintercept=c(summer_dates$summer_start, summer_dates$summer_end), linetype=4) +
  xlab("Date") +
  ylab("Total Daily Offenses") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r table.total_offenses_by_district}
district_count <- table(df.crimes$district)
```

```{r plot.total_crimes_by_district}
# Plot all offenses by district
total.crimes_district %>% 
  ggplot(aes(reorder(district, -total), total)) + 
  geom_col() +
  geom_hline(yintercept=mean(total.crimes_district$total), linetype = 4) +
  xlab("Police District") +
  ylab("Total Offenses") +
  ggtitle("All Offenses by District")

# Plot total vehicle-relation crimes by district
total.auto_district %>% 
  ggplot(aes(reorder(district, -motor_vehicle_involved), motor_vehicle_involved)) + 
  geom_col() +
  geom_hline(yintercept=mean(total.auto_district$motor_vehicle_involved), linetype = 4) +
  xlab("Police District") +
  ylab("Total Auto-Involved Offenses") +
  ggtitle("Auto-Involved Offenses by District")
```

```{r plot.total_offenses_by_type}
total.offense_types %>%
  ggplot(aes(reorder(offense, -total), total)) +
  geom_col() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  xlab("Offenses") +
  ylab("Total") +
  ggtitle("Total Offenses by Type")
```